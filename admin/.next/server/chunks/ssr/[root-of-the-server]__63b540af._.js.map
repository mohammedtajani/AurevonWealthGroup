{"version":3,"sources":["../../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../admin/src/lib/prisma.ts","../../../../../admin/src/actions/investor-actions.ts","../../../../../admin/src/actions/investor-workflow.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient()\r\n}\r\n\r\ndeclare const globalThis: {\r\n    prismaGlobal: ReturnType<typeof prismaClientSingleton>;\r\n} & typeof global;\r\n\r\nconst prisma = globalThis.prismaGlobal ?? prismaClientSingleton()\r\n\r\nexport { prisma }\r\n\r\nif (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma\r\n","'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { z } from 'zod';\r\nimport { redirect } from 'next/navigation';\r\n\r\nconst InvestorSchema = z.object({\r\n    name: z.string().min(1, 'Name is required'),\r\n    email: z.string().email('Invalid email'),\r\n    status: z.enum(['Active', 'Pending', 'Inactive']),\r\n    investmentValue: z.string().optional(),\r\n});\r\n\r\nexport async function getInvestors() {\r\n    try {\r\n        const investors = await prisma.investor.findMany({\r\n            orderBy: { createdAt: 'desc' },\r\n        });\r\n        // Serialize dates if needed, but Server Actions can return JSON serializable data.\r\n        // Prisma dates are objects, Next.js handles them fine usually, but let's be safe if sending to client components directly.\r\n        return investors;\r\n    } catch (error) {\r\n        console.error('Failed to fetch investors:', error);\r\n        throw new Error('Failed to fetch investors');\r\n    }\r\n}\r\n\r\nexport async function createInvestor(formData: FormData) {\r\n    const rawData = {\r\n        name: formData.get('name'),\r\n        email: formData.get('email'),\r\n        status: formData.get('status'),\r\n        investmentValue: formData.get('investmentValue'),\r\n    };\r\n\r\n    const validatedFields = InvestorSchema.safeParse(rawData);\r\n\r\n    if (!validatedFields.success) {\r\n        return {\r\n            errors: validatedFields.error.flatten().fieldErrors,\r\n            message: 'Missing Fields. Failed to Create Investor.',\r\n        };\r\n    }\r\n\r\n    const { name, email, status, investmentValue } = validatedFields.data;\r\n\r\n    try {\r\n        await prisma.investor.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                // @ts-ignore - Enum mismatch might occur if Zod doesn't perfectly match Prisma generated types yet\r\n                status: status as any,\r\n                investmentValue,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        return {\r\n            message: 'Database Error: Failed to Create Investor.',\r\n        };\r\n    }\r\n\r\n    revalidatePath('/admin/investors');\r\n    return { message: 'Success' };\r\n}\r\n\r\nexport async function updateInvestor(id: string, formData: FormData) {\r\n    const rawData = {\r\n        name: formData.get('name'),\r\n        email: formData.get('email'),\r\n        status: formData.get('status'),\r\n        investmentValue: formData.get('investmentValue'),\r\n    };\r\n\r\n    const validatedFields = InvestorSchema.safeParse(rawData);\r\n\r\n    if (!validatedFields.success) {\r\n        return {\r\n            errors: validatedFields.error.flatten().fieldErrors,\r\n            message: 'Missing Fields. Failed to Update Investor.',\r\n        };\r\n    }\r\n\r\n    const { name, email, status, investmentValue } = validatedFields.data;\r\n\r\n    try {\r\n        await prisma.investor.update({\r\n            where: { id },\r\n            data: {\r\n                name,\r\n                email,\r\n                status: status as any,\r\n                investmentValue,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        return { message: 'Database Error: Failed to Update Investor.' };\r\n    }\r\n\r\n    revalidatePath('/admin/investors');\r\n    return { message: 'Updated Investor' };\r\n}\r\n\r\nexport async function deleteInvestor(id: string) {\r\n    try {\r\n        await prisma.investor.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/admin/investors');\r\n        return { message: 'Deleted Investor' };\r\n    } catch (error) {\r\n        return { message: 'Database Error: Failed to Delete Investor.' };\r\n    }\r\n}\r\n","\"use server\";\r\n\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// Helper to generate random password locally\r\nfunction generateRandomPassword(length = 12) {\r\n    const charset = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*\";\r\n    let retVal = \"\";\r\n    for (let i = 0, n = charset.length; i < length; ++i) {\r\n        retVal += charset.charAt(Math.floor(Math.random() * n));\r\n    }\r\n    return retVal;\r\n}\r\n\r\nexport async function registerInvestor(formData: FormData) {\r\n    const name = formData.get(\"name\") as string;\r\n    const email = formData.get(\"email\") as string;\r\n    const value = formData.get(\"investmentValue\") as string;\r\n\r\n    try {\r\n        await prisma.investor.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                investmentValue: value,\r\n                status: \"Pending\",\r\n            },\r\n        });\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Registration failed:\", error);\r\n        return { success: false, error: \"Registration failed. Email might already be in use.\" };\r\n    }\r\n}\r\n\r\nexport async function approveInvestor(investorId: string) {\r\n    try {\r\n        // 1. Fetch Investor\r\n        const investor = await prisma.investor.findUnique({ where: { id: investorId } });\r\n        if (!investor) throw new Error(\"Investor not found\");\r\n\r\n        // 2. Generate Credentials\r\n        const password = generateRandomPassword();\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        // 3. Create User Account\r\n        const user = await prisma.user.create({\r\n            data: {\r\n                name: investor.name,\r\n                email: investor.email,\r\n                password: hashedPassword,\r\n                role: \"INVESTOR\",\r\n            },\r\n        });\r\n\r\n        // 4. Update Investor Record\r\n        await prisma.investor.update({\r\n            where: { id: investorId },\r\n            data: {\r\n                status: \"Active\",\r\n                userId: user.id,\r\n            },\r\n        });\r\n\r\n        // 5. Simulate Email Sending\r\n        console.log(\"---------------------------------------------------\");\r\n        console.log(`ðŸ“§ EMAIL SENT TO: ${investor.email}`);\r\n        console.log(`Subject: Welcome to Aurevon Wealth Group`);\r\n        console.log(`Message: Your account has been approved.`);\r\n        console.log(`Username: ${investor.email}`);\r\n        console.log(`Password: ${password}`);\r\n        console.log(\"---------------------------------------------------\");\r\n\r\n        revalidatePath(\"/admin/investors\");\r\n        return { success: true, password }; // Return password to show in admin UI if needed (optional)\r\n    } catch (error) {\r\n        console.error(\"Approval failed:\", error);\r\n        return { success: false, error: \"Failed to approve investor.\" };\r\n    }\r\n}\r\n\r\nexport async function rejectInvestor(investorId: string) {\r\n    try {\r\n        await prisma.investor.update({\r\n            where: { id: investorId },\r\n            data: { status: \"Rejected\" },\r\n        });\r\n        revalidatePath(\"/admin/investors\");\r\n        return { success: true };\r\n    } catch (error) {\r\n        return { success: false, error: \"Failed to reject investor.\" };\r\n    }\r\n}\r\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}